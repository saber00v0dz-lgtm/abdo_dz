<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuraBot WebView - ØªØ­ÙƒÙ… Ø§Ù„Ø¨ÙˆØª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            color: #666;
            font-size: 1.1em;
        }

        .control-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .control-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 25px;
            font-size: 1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .status-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status-box.active {
            display: block;
        }

        .status-box.error {
            background: #ffebee;
            border-left-color: #f44336;
            color: #c62828;
        }

        .chat-box {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
        }

        .message {
            margin: 10px 0;
            padding: 12px 15px;
            border-radius: 8px;
            max-width: 80%;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-in;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-msg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .bot-msg {
            background: #e0e0e0;
            color: #333;
            margin-right: auto;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"], textarea {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .setting-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .setting-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .setting-item input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .feature-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 15px;
        }

        .feature-card .emoji {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .feature-card h3 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .feature-card p {
            color: #666;
            font-size: 0.9em;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
        }

        .log-viewer {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¤– AuraBot - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <p>ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ø¨ÙˆØª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ù‡Ù†Ø§!</p>
        </header>

        <!-- Bot Control Section -->
        <div class="control-section">
            <h2>âš™ï¸ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¨ÙˆØª</h2>
            
            <div class="status-box" id="botStatus">
                âœ… Ø§Ù„Ø¨ÙˆØª Ù†Ø´Ø· ÙˆØ¬Ø§Ù‡Ø²
            </div>

            <div class="control-buttons">
                <button class="btn btn-primary" onclick="startBot()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª ğŸŸ¢</button>
                <button class="btn btn-secondary" onclick="stopBot()">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª ğŸ›‘</button>
                <button class="btn btn-primary" onclick="checkBotStatus()">ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© ğŸ”</button>
            </div>

            <div class="log-viewer" id="botLog"></div>
        </div>

        <!-- Chat Section -->
        <div class="control-section">
            <h2>ğŸ’¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
            
            <div class="chat-box" id="chatBox"></div>

            <div class="input-group">
                <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±..." />
                <button class="btn btn-primary" onclick="sendTestMessage()">Ø¥Ø±Ø³Ø§Ù„ ğŸ“¤</button>
            </div>

            <button class="btn btn-secondary" onclick="clearChat()">Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ğŸ—‘ï¸</button>
        </div>

        <!-- Page Settings Section -->
        <div class="control-section">
            <h2>ğŸ“„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø©</h2>
            
            <div class="settings-grid">
                <div class="setting-item">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©:</label>
                    <input type="text" id="pageTitle" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†..." />
                </div>
                <div class="setting-item">
                    <label>Ø§Ù„ÙˆØµÙ:</label>
                    <textarea id="pageDesc" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØµÙ..." rows="2"></textarea>
                </div>
                <div class="setting-item">
                    <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©:</label>
                    <input type="color" id="bgColor" value="#667eea" />
                </div>
            </div>

            <div style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="savePageSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ğŸ’¾</button>
            </div>
        </div>

        <!-- Features Overview -->
        <div class="control-section">
            <h2>âœ¨ Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¨ÙˆØª</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="feature-card">
                    <div class="emoji">ğŸ§ </div>
                    <h3>Ø°ÙƒÙŠ</h3>
                    <p>ÙŠÙÙ‡Ù… Ø§Ù„Ø³ÙŠØ§Ù‚ ÙˆÙŠØ±Ø¯ Ø¨Ø°ÙƒØ§Ø¡</p>
                </div>

                <div class="feature-card">
                    <div class="emoji">âš¡</div>
                    <h3>Ø³Ø±ÙŠØ¹</h3>
                    <p>Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙˆØ±ÙŠØ©</p>
                </div>

                <div class="feature-card">
                    <div class="emoji">ğŸŒ</div>
                    <h3>Ø¹Ø±Ø¨ÙŠ</h3>
                    <p>ÙŠØªØ­Ø¯Ø« Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø·Ù„Ø§Ù‚Ø©</p>
                </div>

                <div class="feature-card">
                    <div class="emoji">ğŸ’¾</div>
                    <h3>ÙŠØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø­ÙÙˆØ¸Ø©</p>
                </div>
            </div>
        </div>

        <footer>
            <p>Â© 2024 AuraBot - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Ù…ØªØ­ÙƒÙ… Ù…Ù†: Replit Control Panel â¤ï¸</p>
        </footer>
    </div>

    <script>
        // API URL - ÙŠØ®ØªØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ¦Ø©
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:5000' 
            : window.location.origin;
        const logs = [];

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª
        function addLog(msg) {
            logs.push(`[${new Date().toLocaleTimeString()}] ${msg}`);
            const logViewer = document.getElementById('botLog');
            logViewer.innerHTML = logs.map(l => l).join('<br>');
            logViewer.scrollTop = logViewer.scrollHeight;
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª
        function updateStatus(msg, isError = false) {
            const status = document.getElementById('botStatus');
            status.textContent = msg;
            status.classList.add('active');
            if (isError) {
                status.classList.add('error');
            } else {
                status.classList.remove('error');
            }
            addLog(msg);
        }

        // Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ API Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        async function apiCall(endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                };
                if (body) {
                    options.body = JSON.stringify(body);
                }

                const res = await fetch(`${API_URL}${endpoint}`, options);
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                return await res.json();
            } catch (err) {
                addLog(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${err.message}`);
                throw err;
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
        async function startBot() {
            try {
                await apiCall('/api/bot/start', 'POST');
                updateStatus('âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (err) {
                updateStatus('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª', true);
            }
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª
        async function stopBot() {
            try {
                await apiCall('/api/bot/stop', 'POST');
                updateStatus('â›” ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª');
            } catch (err) {
                updateStatus('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª', true);
            }
        }

        // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª
        async function checkBotStatus() {
            try {
                const data = await apiCall('/api/bot/status');
                const status = data.isRunning ? 'âœ… Ø§Ù„Ø¨ÙˆØª Ù†Ø´Ø·' : 'â›” Ø§Ù„Ø¨ÙˆØª Ù…ØªÙˆÙ‚Ù';
                updateStatus(`${status} | Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${data.messageCount || 0}`);
            } catch (err) {
                updateStatus('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø®Ø§Ø¯Ù…', true);
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©
        function addMessage(text, isUser = false) {
            const chatBox = document.getElementById('chatBox');
            const msgDiv = document.createElement('div');
            msgDiv.className = isUser ? 'message user-msg' : 'message bot-msg';
            msgDiv.textContent = text;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±
        async function sendTestMessage() {
            const input = document.getElementById('msgInput');
            const text = input.value.trim();

            if (!text) return;

            addMessage(text, true);
            addLog(`Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${text}`);
            input.value = '';

            try {
                const data = await apiCall('/api/messages', 'POST', {
                    fromId: 'admin_' + Date.now(),
                    toId: 'bot',
                    text: text
                });

                if (data.botMsg && data.botMsg.text) {
                    addMessage(data.botMsg.text, false);
                    addLog(`Ø±Ø¯ Ø§Ù„Ø¨ÙˆØª: ${data.botMsg.text}`);
                } else {
                    addMessage('âŒ Ø§Ù„Ø¨ÙˆØª Ù…ØªÙˆÙ‚Ù Ø£Ùˆ Ù„Ù… ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø±Ø¯', false);
                }
            } catch (err) {
                addMessage('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', false);
            }
        }

        // Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        function clearChat() {
            document.getElementById('chatBox').innerHTML = '';
            addLog('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©');
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø©
        function savePageSettings() {
            const title = document.getElementById('pageTitle').value;
            const desc = document.getElementById('pageDesc').value;
            const bgColor = document.getElementById('bgColor').value;

            document.title = title || 'AuraBot WebView';
            document.body.style.background = bgColor;

            addLog(`âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ${title}`);
            updateStatus(`âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø©`);
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.addEventListener('load', () => {
            addLog('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
            addLog(`ğŸŒ API URL: ${API_URL}`);
            checkBotStatus();

            // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù€ Enter
            document.getElementById('msgInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendTestMessage();
                }
            });
        });
    </script>
</body>
    </html>
